# Поисковый движок по веб-сайтам

Простой поисковый движок по веб-сайтам, реализованный на Spring Boot. Выполнен в рамках итогового проекта курса
**"Java-разработчик"** от **SkillBox**. Поиск осуществляется по словам **русском** и **английском** языках.
Прочие языки, символы и цифры игнорируются.

Принцип работы: в процессе индексации веб-страниц выполняется **анализ** текста html и **поиск лемм** значимых слов. Под
"незначимыми" словами понимаются междометия, союзы, предлоги и частицы. При анализе они игнорируются. Найденные леммы
используются при анализе поисковых запросов пользователей.

Порядок действий:
1. В [конфигурационном файле](#конфигурационный-файл) Spring Boot настроить список индексируемых сайтов, а также другие
параметры индексирования и поиска.
2. В [веб-интерфейсе](#веб-интерфейс) или с помощью [api](#api) запустить индексацию.
3. После завершения индексирования поиск можно осуществлять также в [веб-интерфейсе](#веб-интерфейс) или с помощью
[api](#api).

## Технологии
В качестве **веб-интерфейса** используется заготовка из курса "Java-разработчик". В ней применяются **HTML**,
**JavaScript** и **CSS**.

Серверная часть (непосредственно поисковый движок) написана на **Java** с применением фреймворка **Spring Boot** версии
**3.1.2**. Анализ веб-страниц выполняется с применением библиотеки **Jsoup**.

## Запуск
Проект реализован на Spring Boot, в котором уже содержится веб-сервер Tomcat. Поэтому запуск можно осуществить как из
IDE (для тестирования), так и путём запуска предварительно собранного файла **JAR** (для использования). Все
персональные настройки проекта задаются в [конфигурационном файле](#конфигурационный-файл).

## Конфигурационный файл
Настройки поискового движка разделены на 3 группы:
- **indexing-settings** – список индексируемых сайтов. Обязательный блок.
- **search-bot-settings** – настройка процесса индексации. Обязательно указание всех настроек, кроме
**requests-interval**. В случае её отсутствия запросы будут выполняться без интервалов ожидания.
- **search-settings** – настройка вывода результатов поискового запроса. Необязательный блок.

Более подробное описание настроек приведено в yaml-блоке ниже.

<details>
<summary>Описание настроек</summary>

```YAML
# Индексируемые сайты
indexing-settings:
  sites:
    - url: https://example.com  # Адрес корня сайта без "/"
      name: Тестовый сайт       # Наименование, которое будет использовано в api и веб-интерфейсе

# Настройки бота, выполняющего индексацию
search-bot-settings:
  # Обязательные настройки, используемые Jsoup
  user-agent: например, имя бота или браузера
  referer: например, адрес другой поисковой системы
  # Необязательный интервал между запросами веб-страниц для анализа.
  # Нужен для минимизации шанса блокировки индексируемыми сайтами.
  requests-interval:
    # Минимальное значение миллисекунд. В случае отсутствия считается равным 0.
    min: 200
    # Максимальное значение миллисекунд.
    # В случае отсутствия, запросы выполняются с фиксированным интервалом min.
    max: 700

# Настройки поиска результатов (для поисковых запросов)
search-settings:
  # Сколько значимых слов нужно выводить слева и справа от поискового слова.
  # В случае отсутствия - 2.
  words-range: 2
```
</details>

## Веб-интерфейс
Веб-интерфейс оставлен в том виде, как он представлен в заготовке. Информация сгруппирована по вкладкам, предоставляющим
доступ к разным [api](#api).

### Dashboard
Открывается по умолчанию. В верхней части отображается [статистика](#статистика) по всем сайтам. Ниже неё выведена
детальная информация о состоянии индексирования каждого сайта.

### Management
Предназначена для управления процессом индексирования (первичным и повторным):
- [запуском](#запуск-индексации-всех-сайтов) и [остановкой](#остановка-индексации-всех-сайтов) полной индексации всех
сайтов;
- [индексацией отдельной веб-страницы](#индексация-указанной-веб-страницы), указанной в поле ввода.

### Search
Предназначена для выполнения [поиска](#поиск-информации-в-индексе-поисковый-запрос) информации в проиндексированных
ранее сайтах. Режим поиска регулируется с помощью **выпадающего списка**: выберите **All sites** для поиска по всем
сайтам или выберите имя конкретного сайта для поиска только в его пределах. Имена сайтов в базу данных были ранее
сохранены из [конфигурационного файла](#конфигурационный-файл). Ниже выпадающего списка расположено поле ввода
поискового запроса.

## API
API сервиса возвращает ответы в формате **JSON**. Исключением выступают технические ошибки, возникающие при внештатных
ситуациях. К таким ситуация относятся, например, обращение к методу api в то время, когда сервис не запущен :-)

### Формат ответа в случае ошибки
В случае возникновения обрабатываемой ошибки возвращается стандартизированный ответ с булевским полем `result = false`
и описанием причины в поле `error`.

<details>
<summary>Пример</summary>

```JSON
{
  "result": false,
  "error": "Индексация сайта ещё не завершена"
}
```
</details>

### Статистика
Метод: **GET**  
Адрес: **/api/statistics**

Возвращает общую статистику (количество сайтов, страниц, лемм) и информацию о состоянии индексирования каждого сайта.
Если хотя бы один сайт в состоянии индексирования, то поле `indexing = true`. Состояние индексирования сайта можно
определить по полю `status`, которое может принимать следующие значения:
- **INDEXING** – выполняется индексация.
- **INDEXED** – сайт успешно проиндексирован.
- **FAILED** – индексация сайта завершилась с ошибкой, текст которой указан в поле `error`. В базе данных хранятся
данные частичной индексации сайта.

<details>
<summary>Пример</summary>

```JSON
{
  "result": true,
  "statistics": {
    "total": {
      "sites": 3,
      "pages": 9817,
      "lemmas": 600735,
      "indexing": true
    },
    "detailed": [
      {
        "url": "https://www.example1.com",
        "name": "Имя сайта 1, ранее сохранённое в базу даных из конфигурационного файла",
        "status": "INDEXING",
        "statusTime": 1704455999,
        "error": "",
        "pages": 3981,
        "lemmas": 321115
      },
      {
        "url": "https://www.example2.com",
        "name": "Имя сайта 2",
        "status": "INDEXED",
        "statusTime": 1704455009,
        "error": "",
        "pages": 3117,
        "lemmas": 289010
      },
      {
        "url": "https://www.example3.com",
        "name": "Имя сайта 3",
        "status": "FAILED",
        "statusTime": 1704460999,
        "error": "Описание ошибки: страница недоступна",
        "pages": 2719,
        "lemmas": 301217
      }
    ]
  }
}
```
</details>

### Запуск индексации всех сайтов
Метод: **GET**  
Адрес: **/api/startIndexing** или **/api/startindexing**

Запуская полную индексацию всех сайтов, указанных в [конфигурационном файле](#конфигурационный-файл). Предварительно из
базы данных удаляется текущая информация по этим сайтам. Сопоставление сайтов конфигурационного файла и базы данных
выполняется по **URL**.

<details>
<summary>Пример (ответ в случае "успеха")</summary>

```JSON
{
  "result": true
}
```
</details>

### Остановка индексации всех сайтов
Метод: **GET**  
Адрес: **/api/stopIndexing** или **/api/stopindexing**

Останавливает индексацию сайтов, которые указанны в [конфигурационном файле](#конфигурационный-файл), но ещё не
проиндексированы (`"status": "INDEXING"`). Сопоставление сайтов конфигурационного файла и базы данных выполняется по
**URL**.

<details>
<summary>Пример (ответ в случае "успеха")</summary>

```JSON
{
  "result": true
}
```
</details>

### Индексация указанной веб-страницы
Метод: **POST**  
Адрес: **/api/indexPage** или **/api/indexpage**  
Параметры тела запроса, передающиеся в формате **x-www-form-urlencoded**:
- **url** – адрес веб-страницы, сайт которой есть в настройках [конфигурационного файла](#конфигурационный-файл).

Выполняет индексацию или повторную индексацию веб-станицы из `url`. Записывает в базу данных новый сайт в случае его
отсутствия (добавили новый сайт в [конфигурационный файл](#конфигурационный-файл), ещё не запускали
[полную индексацию](#запуск-индексации-всех-сайтов)).

<details>
<summary>Пример (ответ в случае "успеха")</summary>

```JSON
{
  "result": true
}
```
</details>

### Поиск информации в индексе (поисковый запрос)
Метод: **GET**  
Адрес: **/api/search**  
Параметры URL:
- **query** – поисковый запрос.
- **site** – сайт без "/" в конце, по которому осуществлять поиск. Необязательный параметр. Если не указан, поиск
осуществляется по всем проиндексированным сайтам.
- **offset** – сдвиг от нулевого индекса для постраничного вывода. Необязательный параметр. Если не указан, то вывод 
выполняется от нулевого индекса;
- **limit** — количество результатов, которое необходимо вывести. Необязательный параметр. Если не указан, то выводится
20 результатов.

Выполняет поиск информации в индексе. Поисковый запрос `query` разбивается на леммы, по которым выполняется поиск в базе
данных. В ответе возвращается информация по каждому сайту. Сайты отсортированы по убыванию относительной релевантности.
В теге `snippet` содержится текст html, в котором значимые слова поискового запроса выделены тегом `<b>`. Количество
слов пояснения (слева и справа от найденного слова) можно настроить в [конфигурационном файле](#конфигурационный-файл).
Если совпадений слишком много (`snippet` более 270 символов), то часть текста скрывается тегом `<details>`.

<details>
<summary>Пример</summary>

```JSON
{
  "result": true,
  "count": 12,
  "data": [
    {
      "site": "https://www.example1.com",
      "siteName": "Имя сайта 1, ранее сохранённое в базу даных из конфигурационного файла",
      "uri": "/path/page.html",
      "title": "Заголовок страницы",
      "snippet": "... фрагмент текста, в котором совпадения <b>выделенные жирным</b> ...",
      "relevance": 1.0
    },
    {
      "site": "https://www.example2.com",
      "siteName": "Имя сайта 2",
      "uri": "/path_to_page/9271",
      "title": "Заголовок другой страницы",
      "snippet": "Если фрагментов <b>несколько</b> ... <details>лишнее <b>скрывается</b></details>",
      "relevance": 0.9528302
    }
  ]
}
```
</details>